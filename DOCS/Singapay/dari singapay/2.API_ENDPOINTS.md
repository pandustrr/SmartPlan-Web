# Payment Gateway API Endpoints Reference

Base URL: `https://your-payment-gateway.com`

All endpoints require OAuth B2B authentication via Bearer token.

## Authentication

### Generate Access Token (OAuth B2B)
```
POST /api/v1.0/access-token/b2b
```

**Headers:**
```
Content-Type: application/json
X-CLIENT-KEY: your_client_key
X-TIMESTAMP: 2024-01-15T10:30:00+07:00
X-SIGNATURE: hmac_sha512(client_key|timestamp, client_secret)
```

**Request Body:**
```json
{
  "grantType": "client_credentials"
}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 3600,
    "tokenType": "Bearer"
  }
}
```

---

## Balance & Account Management

### Inquiry Merchant Balance
```
GET /api/v1.0/balance-inquiry
```

### Inquiry Account Balance
```
GET /api/v1.0/balance-inquiry/{account_id}
```

### List Accounts
```
GET /api/v1.0/accounts
```

### Get Account Detail
```
GET /api/v1.0/accounts/{id}
```

### Create Account
```
POST /api/v1.0/accounts
```

**Request Body:**
```json
{
  "name": "Main Account",
  "description": "Primary business account"
}
```

---

## Virtual Account (Money In)

### List Virtual Accounts
```
GET /api/v1.0/virtual-accounts/{account_id}
```

### Get VA Detail
```
GET /api/v1.0/virtual-accounts/{account_id}/{virtual_account_id}
```

### Create Virtual Account
```
POST /api/v1.0/virtual-accounts/{account_id}
```

**Request Body:**
```json
{
  "bank_code": "BRI",
  "amount": 100000,
  "kind": "temporary",
  "expired_at": 1705305600000,
  "max_usage": 1
}
```

**Parameters:**
- `bank_code`: BRI, MAYBANK, DANAMON
- `kind`: temporary, permanent
- `amount`: min 10000, max 100000000
- `expired_at`: timestamp in milliseconds (required if kind=temporary)
- `max_usage`: 1-255 (required if kind=temporary)

### Delete Virtual Account
```
DELETE /api/v1.0/virtual-accounts/{account_id}/{virtual_account_id}
```

### List VA Transactions
```
GET /api/v1.0/va-transactions/{account_id}
```

### Get VA Transaction Detail
```
GET /api/v1.0/va-transactions/{account_id}/{transaction_id}
```

### **[NEW] Inquiry VA Transaction Status**
```
GET /api/v1.0/va-transactions/{account_id}/inquiry-status/{transaction_id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "transaction_id": "VA240513162304123456",
    "status": "paid",
    "amount": 100000,
    "vendor_fee": 1500,
    "net_amount": 98500,
    "processed_timestamp": "2024-05-13 16:23:04",
    "va_number": "88808123456789",
    "bank_internal_code": "BRI"
  }
}
```

---

## Payment Link (Money In)

### Get Active Payment Methods
```
GET /api/v1.0/payment-link-manage/payment-methods
```

### List Payment Links
```
GET /api/v1.0/payment-link-manage/{account_id}
```

### Get Payment Link Detail
```
GET /api/v1.0/payment-link-manage/{account_id}/{payment_link_id}
```

### Create Payment Link
```
POST /api/v1.0/payment-link-manage/{account_id}
```

**Request Body:**
```json
{
  "reff_no": "INV20240513001",
  "title": "Invoice Payment",
  "required_customer_detail": true,
  "max_usage": 1,
  "expired_at": 1705305600000,
  "total_amount": 150000,
  "items": [
    {
      "name": "Product A",
      "quantity": 1,
      "unit_price": 150000
    }
  ],
  "whitelisted_payment_method": ["VA_BRI", "QRIS_DANAMON"]
}
```

### Update Payment Link
```
PUT /api/v1.0/payment-link-manage/{account_id}/{payment_link_id}
```

### Delete Payment Link
```
DELETE /api/v1.0/payment-link-manage/{account_id}/{payment_link_id}
```

### List Payment Link Histories
```
GET /api/v1.0/payment-link-histories/{account_id}
```

### Get Payment Link History Detail
```
GET /api/v1.0/payment-link-histories/{account_id}/{history_id}
```

### **[NEW] Inquiry Payment Link Status**
```
GET /api/v1.0/payment-link-histories/{account_id}/inquiry-status/{history_id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "id": 123,
    "reff_no": "INV20240513001",
    "status": "paid",
    "amount": 150000,
    "payment_method_name": "Virtual Account BRI",
    "payment_date": "2024-05-13 16:30:00",
    "customer_name": "John Doe",
    "customer_email": "john@example.com"
  }
}
```

---

## QRIS Dynamic (Money In)

### List QRIS Transactions
```
GET /api/v1.0/qris-dynamic/{account_id}
```

### Get QRIS Detail
```
GET /api/v1.0/qris-dynamic/{account_id}/show/{id}
```

### Generate QRIS
```
POST /api/v1.0/qris-dynamic/{account_id}/generate-qr
```

**Request Body:**
```json
{
  "amount": 50000,
  "expired_at": "2024-05-13 23:59:59",
  "tip_indicator": "fixed_amount",
  "tip_value": 5000
}
```

**Parameters:**
- `amount`: min 1000, max 10000000
- `expired_at`: datetime (optional)
- `tip_indicator`: fixed_amount, fixed_percentage, open_amount (optional)
- `tip_value`: depends on tip_indicator (optional)

### Delete QRIS
```
DELETE /api/v1.0/qris-dynamic/{id}/delete
```

### **[NEW] Inquiry QRIS Transaction Status**
```
GET /api/v1.0/qris-dynamic/{account_id}/inquiry-status/{id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "id": 456,
    "reff_no": "QRIS240513162304123456",
    "status": "paid",
    "amount": 50000,
    "tip_amount": 5000,
    "total_amount": 55000,
    "mdr_cost": 825,
    "customer_name": "Jane Doe",
    "processed_at": "2024-05-13 16:45:00"
  }
}
```

---

## Disbursement (Money Out)

### List Disbursements
```
GET /api/v1.0/disbursement/{account_id}
```

### Get Disbursement Detail
```
GET /api/v1.0/disbursement/{account_id}/{transaction_id}
```

### Check Disbursement Fee
```
POST /api/v1.0/disbursement/{account_id}/check-fee
```

**Request Body:**
```json
{
  "to_bank_code": "014",
  "amount": 100000
}
```

### Check Beneficiary Account
```
POST /api/v1.0/disbursement/check-beneficiary
```

**Request Body:**
```json
{
  "to_bank_code": "014",
  "beneficiary_account_no": "1234567890"
}
```

### Transfer (Create Disbursement)
```
POST /api/v1.0/disbursement/{account_id}/transfer
```

**Request Body:**
```json
{
  "to_bank_code": "014",
  "beneficiary_account_no": "1234567890",
  "amount": 100000,
  "notes": "Payment for invoice #001"
}
```

### **[NEW] Inquiry Disbursement Status**
```
GET /api/v1.0/disbursement/{account_id}/inquiry-status/{transaction_id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "transaction_id": "DSB240513162304123456",
    "status": "success",
    "amount": 100000,
    "vendor_fee": 2500,
    "net_amount": 97500,
    "bank_account_name": "John Doe",
    "bank_account_number": "1234567890",
    "processed_timestamp": "2024-05-13 17:00:00",
    "transfer_type": "bifast"
  }
}
```

---

## Bulk Disbursement (Money Out)

### **[NEW] Inquiry Bulk Disbursement Status**
```
GET /api/v1.0/bulk-disbursement/{account_id}/inquiry-status/{transaction_id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "transaction_id": "BDISB240513162304123456",
    "status": "processing",
    "amount": 500000,
    "vendor_fee": 7500,
    "total_records": 5,
    "success_count": 3,
    "failed_count": 1,
    "pending_count": 1
  }
}
```

---

## Cardless Withdrawal / CLWD (Money Out)

### Get Accounts Supporting CLWD
```
GET /api/v1.0/cardless-withdrawals/accounts
```

### Get Payment Vendors for CLWD
```
GET /api/v1.0/cardless-withdrawals/payment-vendors
```

### Get Create Data (Fee & Options)
```
GET /api/v1.0/cardless-withdrawals/{account_id}/create
```

**Query Parameters:**
```
payment_vendor_id=1
```

### List Cardless Withdrawals
```
GET /api/v1.0/cardless-withdrawals/{account_id}
```

### Get CLWD Detail
```
GET /api/v1.0/cardless-withdrawals/{account_id}/show/{id}
```

### Create Cardless Withdrawal
```
POST /api/v1.0/cardless-withdrawals/{account_id}
```

**Request Body:**
```json
{
  "payment_vendor_id": 1,
  "amount": 100000,
  "customer_phone": "08123456789"
}
```

### Cancel Cardless Withdrawal
```
PATCH /api/v1.0/cardless-withdrawals/{account_id}/cancel/{id}
```

### Delete Cardless Withdrawal
```
DELETE /api/v1.0/cardless-withdrawals/{account_id}/delete/{id}
```

### **[NEW] Inquiry CLWD Status**
```
GET /api/v1.0/cardless-withdrawals/{account_id}/inquiry-status/{id}
```

**Response:**
```json
{
  "status": "success",
  "data": {
    "id": 789,
    "transaction_id": "CLWD240513162304123456",
    "status": "completed",
    "amount": 100000,
    "vendor_fee": 1500,
    "total_paid": 98500,
    "customer_id": "08123456789",
    "terminal_name_location": "ATM Mandiri - Jakarta Pusat"
  }
}
```

---

## Statements

### Get Account Statements
```
GET /api/v1.0/statements/{account_id}
```

### Get Statement Detail
```
GET /api/v1.0/statements/{account_id}/{disbursement_transaction_id}
```

---

## Common Response Format

### Success Response
```json
{
  "status": "success",
  "data": {
    // response data here
  },
  "message": "Operation completed successfully"
}
```

### Error Response
```json
{
  "status": "error",
  "message": "Error message here",
  "errors": {
    "field_name": ["Validation error message"]
  }
}
```

---

## HTTP Status Codes

| Code | Description |
|------|-------------|
| 200 | Success |
| 201 | Created |
| 400 | Bad Request |
| 401 | Unauthorized (Invalid or expired token) |
| 403 | Forbidden (IP not whitelisted) |
| 404 | Not Found |
| 422 | Validation Error |
| 500 | Internal Server Error |

---

## Rate Limiting

- Default: 60 requests per minute per IP
- OAuth token generation: 10 requests per minute
- Contact admin for higher limits

---

## Webhooks (Callback URLs)

Payment Gateway will send callbacks to merchant's registered webhook URLs for transaction updates:

### VA Transaction Callback
```
POST {merchant_va_callback_url}
```

### Payment Link Callback
```
POST {merchant_payment_link_callback_url}
```

### Disbursement Callback
```
POST {merchant_disbursement_callback_url}
```

**Callback Payload Example:**
```json
{
  "transaction_id": "VA240513162304123456",
  "status": "paid",
  "amount": 100000,
  "timestamp": "2024-05-13T16:23:04+07:00"
}
```

---

## Need Help?

For API documentation, integration support, or technical issues:
- Email: support@paymentgateway.com
- Documentation: https://docs.paymentgateway.com
- Status Page: https://status.paymentgateway.com
